<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/css/nifty.min.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/css/theme-unla.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/css/custom-unla.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/bootstrap-select/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/sweetalert/sweetalert.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/switchery/switchery.min.css">
    <link rel="stylesheet" href="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/bootstrap-validator/bootstrapValidator.min.css">

    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/js/jquery.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/js/bootstrap.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/js/nifty.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/sweetalert/sweetalert.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/switchery/switchery.min.js"></script>
    <script src="https://ti.unla.edu.mx/repositoriosii/Nifty_2.9.1/plugins/bootstrap-validator/bootstrapValidator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <style>
        .panel-footer {
            border-bottom-right-radius: 15px !important;
            border-bottom-left-radius: 15px !important;
        }

        .btn {
            text-transform: none !important;
        }
    </style>

    
</head>

<body>

    <div id="app">
        <div id="page-content">
            <div class="row">
                <div class="col-md-8 col-md-offset-2">
                    <div class="panel">
                        <div class="panel-heading pad-top mar-btm">
                            <div class="panel-control">
                                <select v-model="question.typeSelected" data-placeholder="Tipo de pregunta" id="chosen-select" class="selectpicker">                                
                                    <option value="" selected disabled hidden>Tipo de pregunta:</option>
                                    <option value="LinearScale">LinearScale</option>
                                    <option value="Radiobutton">Radiobutton</option>
                                    <option value="Checkbox">Checkbox</option>
                                    <option value="LongAnswer">LongAnswer</option>
                                </select>
                            </div>
                            <h3 class="panel-title">
                                <input v-model="question.title" type="text" class="form-control" placeholder="Título de la pregunta...">
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div class="well">
                                <linear-scale v-show="question.typeSelected==='LinearScale'" v-on:change-parent-linearscale="updateLinearScale"></linear-scale>
                                <radiobutton v-show="question.typeSelected==='Radiobutton'" v-on:change-parent-radio="updateRadiobutton"></radiobutton>
                                <checkbox v-show="question.typeSelected==='Checkbox'" v-on:change-parent-checkbox="updateCheckbox"></checkbox>
                                <long-answer  v-show="question.typeSelected==='LongAnswer'" v-on:change-parent-longanswer="updateLongAnswer"></long-answer>
                            </div>
                            <div class="text-right">Requerido <input v-model="question.required" id="sw-required" type="checkbox" checked></div>
                        </div>
                        <div class="panel-footer text-right">
                            <button v-on:click="submitData" class="btn btn-morado btn-rounded">GUARDAR</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
                    <div class="list-group">
                        <li v-for="item in result" class="list-group-item bg-light">
                            <div>
                                <span class="pull-right text-bold">
                                    <button v-on:click="removeElement(item.Id)" class="btn btn-dark btn-xs btn-rounded">                            
                                        BORRAR
                                    </button>
                                </span>
                                
                                <div>
                                    <h5 class="list-group-item-heading">{{item.Title}} <span class="text-thin">({{item.Type}})</span></h5>
                                    <em v-if="item.Required==true">-Obligatoria-</em>
                                </div>
                                <div v-if="item.Type=='LinearScale'">
                                    <ul>
                                        <li>LowerValue: {{item.LinearScale.LowerValue}}</li>
                                        <li>UpperValue: {{item.LinearScale.UpperValue}}</li>
                                        <li>LowerValueDescription: {{item.LinearScale.LowerValueDescription}}</li>
                                        <li>UpperValueDescription: {{item.LinearScale.UpperValueDescription}}</li>
                                    </ul>                                
                                </div>
                                <div v-if="item.Type=='Radiobutton'">
                                    <ul>
                                        <li>Items: {{item.Radiobutton.Items}}</li>
                                    </ul>                                
                                </div>
                                <div v-if="item.Type=='Checkbox'">
                                    <ul>
                                        <li>Items: {{item.Checkbox.Items}}</li>
                                    </ul>                                
                                </div>
                                <div v-if="item.Type=='LongAnswer'">
                                    <ul>
                                        <li>Placeholder: {{item.LongAnswer.Placeholder}}</li>
                                    </ul>                                
                                </div>
                            </div>
                
                        </li>
                    </div>
                </div>
            </div>        
        </div>
    </div>
    
    <script src="components/LinearScale.js"></script>
    <script src="components/Radiobutton.js"></script>
    <script src="components/Checkbox.js"></script>
    <script src="components/LongAnswer.js"></script>
    <script src="components/Item.js"></script>

    <!-- <script src="formulario.js"></script> -->

    <script>
        const url = 'http://sii.unla.edu.mx/FormulariosUNLA/Forms/Questions'

        $(document).ready(function(){
            var elem = document.querySelector('#sw-required');
            var init = new Switchery(elem);
        });

        var app = new Vue({
            el: '#app',
            data: {
                question:{
                    title:'',
                    typeSelected:'',                        
                    required:true,
                    LinearScale:{
                        title: 'LinearScale',
                        lowerValue: 1,
                        upperValue: 2,
                        lowerValueDescription:'',
                        upperValueDescription:'',
                    },
                    Radiobutton:{
                        title: 'Radiobutton',
                        counter: 1,
                        items:[]
                    },
                    Checkbox:{
                        title: 'Checkbox',
                        counter: 1,
                        items:[]
                    },
                    LongAnswer:{
                        title: 'LongAnswer',
                        placeholder:''
                    }
                },
                jsonData:'',
                jsonObj:null, 
                result:[]             
            },

            created() {                
                this.refresh()
            },

            methods:{
                submitData(event){
                    //TODO validar que los datos estén llenos
                    event.preventDefault();

                    $.ajax({
                        type: "POST",
                        url: `${url}/InsertQuestion`,
                        data: this.question,
                        success: function (result, status, xhr) {
                            console.log(result)
                            console.log('Guardado...')
                            app.refresh()

                            //TODO validar cuando responda con un error
                            // if (result.includes("Error")) {
                            //     msgAlert(result, "danger");
                            // } else {
                            //     console.log(result)
                            //     // refresh()
                            //     // appPerfiles.perfil = {
                            //     //     nombre: '',
                            //     //     costo: '',
                            //     //     grupo: ''
                            //     // };
                            //     // appPerfiles.refresh();
                            // }
                        },
                        error: function (xhr, status, error) {
                            var msg = '<span class="text-bold">' + error + '</span><br/>Estatus: ' + xhr.status + '<br/>Descripción: ' + xhr.statusText;
                            msgAlert(msg, "danger");
                        }
                    });
                    
                    var a=this.$children.entries()
                    for(i of a){
                        if(i[1].title==this.question.typeSelected)
                            console.log(i[1].title)                            
                    }

                    this.jsonData=JSON.stringify(this.question)
                    this.jsonObj=JSON.parse(this.jsonData)
                },
                updateLinearScale(value){
                    this.question.LinearScale=value
                },
                updateRadiobutton(value){
                    this.question.Radiobutton=value

                },
                updateCheckbox(value){
                    this.question.Checkbox=value

                },
                updateLongAnswer(value){
                    this.question.LongAnswer=value

                },
                refresh(){
                    fetch(`${url}/GetQuestions`)
                        .then(res => res.json())
                        .then(res => this.result=res)
                },
                removeElement(id) {
                    $.ajax({
                        type: "POST",
                        url: `${url}/DeleteQuestion`,
                        data: { id },
                        success: function (result, status, xhr) {
                            console.log('Borrado...')
                            app.refresh()                            
                        },
                        error: function (xhr, status, error) {
                            var msg = '<span class="text-bold">' +
                                error +
                                '</span><br/>Estatus: ' +
                                xhr.status +
                                '<br/>Descripción: ' +
                                xhr.statusText;
                            msgAlert(msg, "danger");
                        }
                    });
                },
            },

            computed:{
                information(){
                    return JSON.stringify(this.question)                    
                }
            }
        })
    </script>

</body>

</html>